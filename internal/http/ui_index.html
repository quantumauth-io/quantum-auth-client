<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Quantum Auth Client</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 20px; }
        h1 { margin-bottom: 0.5rem; }
        h2 { margin-top: 1.5rem; }
        form, .block { border: 1px solid #ccc; padding: 12px; margin: 8px 0; border-radius: 6px; }
        label { display: block; margin: 4px 0 2px; font-size: 0.9rem; }
        input { width: 100%; padding: 4px 6px; margin-bottom: 6px; }
        button { padding: 6px 10px; cursor: pointer; }
        #output { white-space: pre-wrap; background: #111; color: #0f0; padding: 10px; border-radius: 6px; margin-top: 12px; max-height: 300px; overflow: auto; font-family: monospace; font-size: 0.85rem; }
    </style>
</head>
<body>
<h1>Quantum Auth Client UI</h1>
<p>Talking to client on <code>http://localhost:8090</code> (this page) &amp; forwarding to QuantumAuth server.</p>

<div class="block">
    <button id="btn-health" type="button">GET /api/health</button>
</div>

<form id="form-register-user">
    <h2>Register User – POST /api/users/register</h2>
    <label>Email</label>
    <input id="ru-email" type="email" required />

    <label>Password</label>
    <input id="ru-password" type="password" required />

    <label>Username</label>
    <input id="ru-username" type="text" required />

    <button type="submit">Register User</button>
</form>

<form id="form-register-device">
    <h2>Register Device – POST /api/devices/register</h2>
    <label>User ID</label>
    <input id="rd-user-id" type="text" required />

    <label>Device Label</label>
    <input id="rd-label" type="text" value="nitro-laptop" required />

    <button type="submit">Register Device</button>
</form>

<form id="form-auth-challenge">
    <h2>Auth Challenge – POST /api/auth/challenge</h2>
    <label>Device ID</label>
    <input id="ac-device-id" type="text" required />
    <button type="submit">Request Challenge</button>
</form>

<form id="form-auth-verify">
    <h2>Auth Verify – POST /api/auth/verify</h2>
    <label>Challenge ID</label>
    <input id="av-challenge-id" type="text" required />

    <label>Device ID</label>
    <input id="av-device-id" type="text" required />

    <label>Password</label>
    <input id="av-password" type="password" required />

    <label>Nonce</label>
    <input id="av-nonce" type="number" required />

    <button type="submit">Complete Challenge</button>
</form>

<form id="form-secure-ping">
    <h2>Secure Ping – GET /api/secure-ping</h2>
    <label>User ID</label>
    <input id="sp-user-id" type="text" required />

    <label>Device ID</label>
    <input id="sp-device-id" type="text" required />

    <button type="submit">Secure Ping</button>
</form>

<h2>Output</h2>
<div id="output"></div>

<script>
    const out = document.getElementById('output');

    function logResponse(title, res, body) {
        out.textContent =
            `[${new Date().toISOString()}] ${title}\n` +
            `Status: ${res.status} ${res.statusText}\n` +
            (body ? `Body:\n${body}\n` : '') +
            '\n-------------------------\n' +
            out.textContent;
    }

    async function doJSON(url, method, payload) {
        const res = await fetch(url, {
            method,
            headers: { 'Content-Type': 'application/json' },
            body: payload ? JSON.stringify(payload) : undefined,
        });
        const text = await res.text();
        return { res, text };
    }

    document.getElementById('btn-health').onclick = async () => {
        const { res, text } = await doJSON('/api/health', 'GET');
        logResponse('GET /api/health', res, text);
    };

    document.getElementById('form-register-user').onsubmit = async (e) => {
        e.preventDefault();
        const payload = {
            email:    document.getElementById('ru-email').value,
            password: document.getElementById('ru-password').value,
            username: document.getElementById('ru-username').value,
        };
        const { res, text } = await doJSON('/api/users/register', 'POST', payload);
        logResponse('POST /api/users/register', res, text);
    };

    document.getElementById('form-register-device').onsubmit = async (e) => {
        e.preventDefault();
        const payload = {
            user_id:      document.getElementById('rd-user-id').value,
            label: document.getElementById('rd-label').value,
        };
        const { res, text } = await doJSON('/api/devices/register', 'POST', payload);
        logResponse('POST /api/devices/register', res, text);
    };

    document.getElementById('form-auth-challenge').onsubmit = async (e) => {
        e.preventDefault();
        const payload = {
            device_id: document.getElementById('ac-device-id').value,
        };
        const { res, text } = await doJSON('/api/auth/challenge', 'POST', payload);
        logResponse('POST /api/auth/challenge', res, text);
    };

    document.getElementById('form-auth-verify').onsubmit = async (e) => {
        e.preventDefault();
        const payload = {
            challenge_id: document.getElementById('av-challenge-id').value,
            device_id:    document.getElementById('av-device-id').value,
            nonce:        Number(document.getElementById('av-nonce').value),
            password:     document.getElementById('av-password').value,

        };
        const { res, text } = await doJSON('/api/auth/verify', 'POST', payload);
        logResponse('POST /api/auth/verify', res, text);
    };

    document.getElementById('form-secure-ping').onsubmit = async (e) => {
        e.preventDefault();
        const userID   = document.getElementById('sp-user-id').value;
        const deviceID = document.getElementById('sp-device-id').value;

        const url = `/api/secure-ping?user_id=${encodeURIComponent(userID)}&device_id=${encodeURIComponent(deviceID)}`;
        const res = await fetch(url, { method: 'GET' });
        const text = await res.text();
        logResponse('GET /api/secure-ping', res, text);
    };
</script>
</body>
</html>
